## Parse json to df
df <- httr::content(response_df, as = "text", encoding = "UTF-8")
df <- jsonlite::fromJSON(df)
## JSON to dataframe
df <- as.data.frame(df$data)
return(df)
}
sb_get()
api_key <- "b0f966428bde45dc913ffd59d88b9dc0"
sb_get(api_key, "solvencia/componentes", "2022-01", tipo_entidad = "BM")
sb_get <- function(api_key, end_point, periodo_inicial, periodo_final = NULL,
entidad = NULL, tipo_entidad){
## Define base_url
base_url <- "https://apis.sb.gob.do/estadisticas/"
## Get json
response_df <- httr::GET(paste0(base_url, end_point),
httr::add_headers("Ocp-Apim-Subscription-Key" = api_key),
query = list(
periodoInicial = periodo_inicial,
periodoFinal = periodo_final,
entidad = entidad,
tipoEntidad = tipo_entidad),
encode = "json")
print(response_df)
## Parse json to df
df <- httr::content(response_df, as = "text", encoding = "UTF-8")
df <- jsonlite::fromJSON(df)
## JSON to dataframe
df <- as.data.frame(df$data)
return(df)
}
api_key <- "b0f966428bde45dc913ffd59d88b9dc0"
sb_get(api_key, "solvencia/componentes", "2022-01", tipo_entidad = "BM")
response_df
sb_get <- function(api_key, end_point, periodo_inicial, periodo_final = NULL,
entidad = NULL, tipo_entidad){
## Define base_url
base_url <- "https://apis.sb.gob.do/estadisticas/"
## Get json
response_df <- httr::GET(paste0(base_url, end_point),
httr::add_headers("Ocp-Apim-Subscription-Key" = api_key),
query = list(
periodoInicial = periodo_inicial,
periodoFinal = periodo_final,
entidad = entidad,
tipoEntidad = tipo_entidad),
encode = "json")
print(response_df)
if (stringr::str_detect(response_df, "400")){
print(bobo)
}
## Parse json to df
df <- httr::content(response_df, as = "text", encoding = "UTF-8")
df <- jsonlite::fromJSON(df)
## JSON to dataframe
df <- as.data.frame(df$data)
return(df)
}
(api_key, "solvencia/componentes", "2022-01", tipo_entidad = "BM")
sb_get(api_key, "solvencia/componentes", "2022-01", tipo_entidad = "BM")
sb_get(api_key, "solvencia/componentes", "2022-01", tipo_entidad = "BM", entidad = "APAP")
#' GET data
#' Esta funcion carga los datos del endpoint solicitado en formato data frame
#' @param api_key Primary Key de la suscripcion.
#' @param end_point End point a consultar. Usa 'end_points()' para ver
#' todas las opciones
#' @param periodo_inicial Fecha en donde incian las series solicitadas
#' @param periodo_final Fecha en donde terminan las series. No obligatoria.
#' @param entidad ID de la entidad a consultar. No se puede introducir al mismo
#' tiempo que 'tipo_entidad'. Usa 'entidades()' para ver todos los IDs.
#' @param tipo_entidad ID del tipo de entidad a consulta. No se puede introducir
#' al mimo tiempo que 'entidad'. Usa 'tipo_entidad()' para ver todas
#' las opciones
#' @export
sb_get <- function(api_key, end_point, periodo_inicial, periodo_final = NULL,
entidad = NULL, tipo_entidad = NULL){
## Define base_url
base_url <- "https://apis.sb.gob.do/estadisticas/"
## Get json
response_df <- httr::GET(paste0(base_url, end_point),
httr::add_headers("Ocp-Apim-Subscription-Key" = api_key),
query = list(
periodoInicial = periodo_inicial,
periodoFinal = periodo_final,
entidad = entidad,
tipoEntidad = tipo_entidad),
encode = "json")
print(response_df)
## Parse json to df
df <- httr::content(response_df, as = "text", encoding = "UTF-8")
df <- jsonlite::fromJSON(df)
## JSON to dataframe
df <- as.data.frame(df$data)
return(df)
}
?sb_get()
sb_get(?)
sb_get()?
library(supeRbancos)
usethis::use_testthat()
devtools::document()
rm(list = c("end_points", "sb_get"))
devtools::document()
#' Print de IDs de las entidades del API
#' @export
entidades <- function(){
cat("
**Nombres de Entidades de Intermediación Financiera (EIF)**\n
ABONAP = Asociación Bonao de Ahorros y Préstamos\n
ACTIVO = Banco Múltiple Activo Dominicana, S. A.\n
ADEMI = Banco Múltiple Ademi, S. A.\n
ADOPEM = Banco de Ahorro y Crédito Adopem, S. A.\n
ALAVER = Asociación La Vega Real de Ahorros y Préstamos\n
APAP = Asociación Popular de Ahorros y Préstamos\n
ATLANTICO = Banco Atlántico de Ahorro Y Crédito, S. A.\n
BANCAMERICA = Banco Múltiple de Las Américas, S. A. (Bancamerica)\n
BANCO AGRICOLA = Banco Agrícola de La República Dominicana\n
BANCO BACC = Banco BACC de Ahorro y Crédito del Caribe, S. A.\n
BANCOTUI = Banco de Ahorro y Crédito Bancotui, S. A.\n
BANDEX = Banco Nacional de Las Exportaciones (Bandex)\n
BANESCO = Banesco Banco Múltiple, S. A.\n
BANFONDESA = Banco de Ahorro y Crédito Fondesa, S. A. (Banfondesa)\n
BANRESERVAS = Banco de Reservas de la República Dominicana - Banco De Servicios Múltiple\n
BDI = Banco Múltiple BDI, S. A.\n
BELLBANK = Banco Multiple Bellbank, S. A.\n
BHD LEON = Banco Múltiple BHD León, S. A.\n
BONANZA = Bonanza Banco de Ahorro y Crédito, S. A.\n
CARIBE = Banco Múltiple Caribe Internacional, S. A.\n
CIBAO = Asociación Cibao de Ahorros y Préstamos\n
CITIBANK = Citibank, N. A.\n
COFACI = Banco de Ahorro Y Crédito Cofaci, S. A.\n
CONFISA = Banco de Ahorro y Crédito Confisa, S. A.\n
DUARTE = Asociación Duarte de Ahorros y Préstamos\n
EMPIRE = Banco de Ahorro y Crédito Empire, S. A.\n
FIHOGAR = Banco de Ahorro y Crédito Fihogar, S. A.\n
GRUFICORP = Banco de Ahorro y Crédito Gruficorp, S. A.\n
JMMB = Banco de Ahorro y Crédito JMMB Bank, S. A.\n
LA NACIONAL = Asociación La Nacional de Ahorros Y Préstamos\n
LAFISE = Banco Múltiple Lafise, S. A.\n
LEASING CONFISA = Corporación de Crédito Leasing Confisa, S. A.\n
LOPEZ DE HARO = Banco Múltiple López de Haro, S. A.\n
MAGUANA = Asociación Maguana de Ahorros y Préstamos\n
MOCANA = Asociación Mocana de Ahorros y Préstamos\n
MONUMENTAL = Corporación de Crédito Monumental, S. A.\n
MOTOR CREDITO = Motor Crédito, S. A. Banco de Ahorro y Crédito\n
NORPRESA = Corporación de Crédito Nordestana de Préstamos, S. A.\n
OFICORP = Corporación de Crédito Oficorp, S. A.\n
OPTIMA = Optima Corporación de Crédito, S. A.\n
PERAVIA = Asociación Peravia de Ahorros y Préstamos\n
POPULAR = Banco Popular Dominicano, S. A. - Banco Múltiple\n
PROMERICA = Banco Múltiple Promérica de la República Dominicana, S. A.\n
REIDCO = Corporación de Crédito Reidco, S. A.\n
ROMANA = Asociación Romana de Ahorros y Préstamos\n
SANTA CRUZ = Banco Múltiple Santa Cruz, S. A.\n
SCOTIABANK = Scotiabank República Dominicana, S. A. - Banco Múltiple\n
UNION = Banco de Ahorro y Crédito Unión, S. A.\n
VIMENCA = Banco Múltiple Vimenca, S. A.\n
"
)
}
entidades()
#' Print de IDs de las entidades del API
#' @export
entidades <- function(){
cat("
**Nombres de Entidades de Intermediación Financiera (EIF)**\n
Parámetro = Descripción\n
ABONAP = Asociación Bonao de Ahorros y Préstamos\n
ACTIVO = Banco Múltiple Activo Dominicana, S. A.\n
ADEMI = Banco Múltiple Ademi, S. A.\n
ADOPEM = Banco de Ahorro y Crédito Adopem, S. A.\n
ALAVER = Asociación La Vega Real de Ahorros y Préstamos\n
APAP = Asociación Popular de Ahorros y Préstamos\n
ATLANTICO = Banco Atlántico de Ahorro Y Crédito, S. A.\n
BANCAMERICA = Banco Múltiple de Las Américas, S. A. (Bancamerica)\n
BANCO AGRICOLA = Banco Agrícola de La República Dominicana\n
BANCO BACC = Banco BACC de Ahorro y Crédito del Caribe, S. A.\n
BANCOTUI = Banco de Ahorro y Crédito Bancotui, S. A.\n
BANDEX = Banco Nacional de Las Exportaciones (Bandex)\n
BANESCO = Banesco Banco Múltiple, S. A.\n
BANFONDESA = Banco de Ahorro y Crédito Fondesa, S. A. (Banfondesa)\n
BANRESERVAS = Banco de Reservas de la República Dominicana - Banco De Servicios Múltiple\n
BDI = Banco Múltiple BDI, S. A.\n
BELLBANK = Banco Multiple Bellbank, S. A.\n
BHD LEON = Banco Múltiple BHD León, S. A.\n
BONANZA = Bonanza Banco de Ahorro y Crédito, S. A.\n
CARIBE = Banco Múltiple Caribe Internacional, S. A.\n
CIBAO = Asociación Cibao de Ahorros y Préstamos\n
CITIBANK = Citibank, N. A.\n
COFACI = Banco de Ahorro Y Crédito Cofaci, S. A.\n
CONFISA = Banco de Ahorro y Crédito Confisa, S. A.\n
DUARTE = Asociación Duarte de Ahorros y Préstamos\n
EMPIRE = Banco de Ahorro y Crédito Empire, S. A.\n
FIHOGAR = Banco de Ahorro y Crédito Fihogar, S. A.\n
GRUFICORP = Banco de Ahorro y Crédito Gruficorp, S. A.\n
JMMB = Banco de Ahorro y Crédito JMMB Bank, S. A.\n
LA NACIONAL = Asociación La Nacional de Ahorros Y Préstamos\n
LAFISE = Banco Múltiple Lafise, S. A.\n
LEASING CONFISA = Corporación de Crédito Leasing Confisa, S. A.\n
LOPEZ DE HARO = Banco Múltiple López de Haro, S. A.\n
MAGUANA = Asociación Maguana de Ahorros y Préstamos\n
MOCANA = Asociación Mocana de Ahorros y Préstamos\n
MONUMENTAL = Corporación de Crédito Monumental, S. A.\n
MOTOR CREDITO = Motor Crédito, S. A. Banco de Ahorro y Crédito\n
NORPRESA = Corporación de Crédito Nordestana de Préstamos, S. A.\n
OFICORP = Corporación de Crédito Oficorp, S. A.\n
OPTIMA = Optima Corporación de Crédito, S. A.\n
PERAVIA = Asociación Peravia de Ahorros y Préstamos\n
POPULAR = Banco Popular Dominicano, S. A. - Banco Múltiple\n
PROMERICA = Banco Múltiple Promérica de la República Dominicana, S. A.\n
REIDCO = Corporación de Crédito Reidco, S. A.\n
ROMANA = Asociación Romana de Ahorros y Préstamos\n
SANTA CRUZ = Banco Múltiple Santa Cruz, S. A.\n
SCOTIABANK = Scotiabank República Dominicana, S. A. - Banco Múltiple\n
UNION = Banco de Ahorro y Crédito Unión, S. A.\n
VIMENCA = Banco Múltiple Vimenca, S. A.\n
"
)
}
entidades()
devtools::document()
devtools::document()
rm(list = c("end_points", "sb_get"))
rm(list = c("entidades"))
devtools::document()
use_r("sb-get")
usethis::use_r(sb_get)
usethis::use_r("sb_get")
usethis::use_test()
test_that("get works with no periodoFinal nor entidad", {
api_key <- "b0f966428bde45dc913ffd59d88b9dc0"
sb_get(api_key, end_point = "solvencia/componentes",
periodo_inicial = "2022-01", tipo_entidad = "BM")
})
usethis::test_that("get works with no periodoFinal nor entidad", {
api_key <- "b0f966428bde45dc913ffd59d88b9dc0"
sb_get(api_key, end_point = "solvencia/componentes",
periodo_inicial = "2022-01", tipo_entidad = "BM")
})
testthat::test_file("tests/testthat/test-sb_get.R")
testthat::test_file("tests/testthat/test-sb_get.R")
testthat::test_file("tests/testthat/test-sb_get.R")
testthat::test_file("tests/testthat/test-sb_get.R")
testthat::test_file("tests/testthat/test-sb_get.R")
end_points
endpoints <- c('captaciones/localidad', 'captaciones/moneda', 'captaciones/sector-depositante', 'carteras/creditos/clasificacion-riesgo', 'carteras/creditos/genero', 'carteras/creditos/localidad','carteras/creditos/moneda','carteras/creditos/sectores-economicos',
'carteras/creditos/tipo', 'carteras/creditos/facilidad', 'carteras/creditos/inversiones', 'detalle-entidades/acceso', 'estados/resultados/eic','estados/resultados/eif','estados/situacion/eic', 'estados/situacion/eif',
'indicadores/morosidad-estresada', 'indicadores/riesgo-credito', 'indicadores/financieros', 'indicadores/principales', 'reclamaciones/eif', 'reclamaciones/prousuario', 'solvencia/componentes','subagentes/operaciones',
'subagentes/actividad-economica', 'subagentes/total', 'tasas-comisiones/tarjetas-credito')
for (i in endpoints){
test_that("get works with no entidad", {
expect_s3_class(sb_get(api_key = "b0f966428bde45dc913ffd59d88b9dc0",
end_point = "solvencia/componentes",
periodo_inicial = "2022-01", periodo_final = "2022-02",
tipo_entidad =  "BM"), "data.frame")
})
test_that("get works with no periodoFinal nor entidad", {
expect_s3_class(sb_get(api_key = "b0f966428bde45dc913ffd59d88b9dc0",
end_point = "solvencia/componentes",
periodo_inicial = "2022-01", tipo_entidad = "BM"), "data.frame")
})
test_that("get works with no tipoEntidad", {
expect_s3_class(sb_get(api_key = "b0f966428bde45dc913ffd59d88b9dc0",
end_point = "solvencia/componentes",
periodo_inicial = "2022-01", periodo_final = "2022-02",
entidad = "ACTIVO"), "data.frame")
})
}
endpoints <- c('captaciones/localidad', 'captaciones/moneda', 'captaciones/sector-depositante', 'carteras/creditos/clasificacion-riesgo', 'carteras/creditos/genero', 'carteras/creditos/localidad','carteras/creditos/moneda','carteras/creditos/sectores-economicos',
'carteras/creditos/tipo', 'carteras/creditos/facilidad', 'carteras/creditos/inversiones', 'detalle-entidades/acceso', 'estados/resultados/eic','estados/resultados/eif','estados/situacion/eic', 'estados/situacion/eif',
'indicadores/morosidad-estresada', 'indicadores/riesgo-credito', 'indicadores/financieros', 'indicadores/principales', 'reclamaciones/eif', 'reclamaciones/prousuario', 'solvencia/componentes','subagentes/operaciones',
'subagentes/actividad-economica', 'subagentes/total', 'tasas-comisiones/tarjetas-credito')
entidades <- c('ABONAP','ACTIVO','ADEMI','ADOPEM','ALAVER','APAP','ATLANTICO','BANCAMERICA','BANCO AGRICOLA','BANCO BACC','BANCOTUI','BANDEX','BANESCO','BANFONDESA','BANRESERVAS','BDI',
'BELLBANK','BHD LEON','BONANZA','CARIBE','CIBAO','CITIBANK','COFACI','CONFISA','DUARTE','EMPIRE','FIHOGAR','GRUFICORP','JMMB','LA NACIONAL','LAFISE','LEASING CONFISA','LOPEZ DE HARO','MAGUANA',
'MOCANA','MONUMENTAL','MOTOR CREDITO','NORPRESA','OFICORP','OPTIMA','PERAVIA','POPULAR','PROMERICA','REIDCO','ROMANA','SANTA CRUZ','SCOTIABANK','UNION','VIMENCA')
tipo_entidades <- c('AAyP','BAyC','BM','CC','EP','TODOS')
for (i in endpoints){
test_that("get works with no periodoFinal nor entidad", {
expect_s3_class(sb_get(api_key = "b0f966428bde45dc913ffd59d88b9dc0",
end_point = i,
periodo_inicial = "2022-01", tipo_entidad = "BM"), "data.frame")
})
for (j in tipo_entidades){
test_that("get works with no entidad", {
expect_s3_class(sb_get(api_key = "b0f966428bde45dc913ffd59d88b9dc0",
end_point = i,
periodo_inicial = "2022-01", periodo_final = "2022-02",
tipo_entidad =  "BM"), "data.frame")
})
}
for (k in entidades){
test_that("get works with no tipoEntidad", {
expect_s3_class(sb_get(api_key = "b0f966428bde45dc913ffd59d88b9dc0",
end_point = i,
periodo_inicial = "2022-01", periodo_final = "2022-02",
entidad = k), "data.frame")
})
}
}
#' GET Endpoints SB
#'
#' Esta funcion carga los datos del endpoint solicitado en formato data frame
#' @param api_key Primary Key de la suscripcion.
#' @param end_point Endpoint a consultar. Usa 'end_points()' para ver
#' todas las opciones
#' @param periodo_inicial Fecha en donde incian las series solicitadas
#' @param periodo_final Fecha en donde terminan las series. No obligatoria.
#' @param entidad ID de la entidad a consultar. No se puede introducir al mismo
#' tiempo que 'tipo_entidad'. Usa 'entidades()' para ver todos los IDs.
#' @param tipo_entidad ID del tipo de entidad a consulta. No se puede introducir
#' al mimo tiempo que 'entidad'. Usa 'tipo_entidad()' para ver todas
#' las opciones
#' @return Un dataframe
#' @export
sb_get <- function(api_key, end_point, periodo_inicial, periodo_final = NULL,
entidad = NULL, tipo_entidad = NULL){
## Exit cuando entidad y tipo de entidad no sean nulas al mismo tiempo
if (!is.null(entidad) | !is.null(tipo_entidad)){
stop("Se introdujo entidad y tipo de entidad al mismo tiempo.")
}
## Define base_url
base_url <- "https://apis.sb.gob.do/estadisticas/"
## Get json
response_df <- httr::GET(paste0(base_url, end_point),
httr::add_headers("Ocp-Apim-Subscription-Key" = api_key),
query = list(
periodoInicial = periodo_inicial,
periodoFinal = periodo_final,
entidad = entidad,
tipoEntidad = tipo_entidad),
encode = "json")
print(response_df)
## Parse json to df
df <- httr::content(response_df, as = "text", encoding = "UTF-8")
df <- jsonlite::fromJSON(df)
## JSON to dataframe
df <- as.data.frame(df$data)
return(df)
}
sb_get("b0f966428bde45dc913ffd59d88b9dc0", "captaciones/localidad", "2020-01", entidad = "ACTIVO")
sb_get("b0f966428bde45dc913ffd59d88b9dc0", "captaciones/localidad", "2020-01", entidad = "ACTIVO")
#' GET Endpoints SB
#'
#' Esta funcion carga los datos del endpoint solicitado en formato data frame
#' @param api_key Primary Key de la suscripcion.
#' @param end_point Endpoint a consultar. Usa 'end_points()' para ver
#' todas las opciones
#' @param periodo_inicial Fecha en donde incian las series solicitadas
#' @param periodo_final Fecha en donde terminan las series. No obligatoria.
#' @param entidad ID de la entidad a consultar. No se puede introducir al mismo
#' tiempo que 'tipo_entidad'. Usa 'entidades()' para ver todos los IDs.
#' @param tipo_entidad ID del tipo de entidad a consulta. No se puede introducir
#' al mimo tiempo que 'entidad'. Usa 'tipo_entidad()' para ver todas
#' las opciones
#' @return Dataframe con los datos del endpoint consultado
#' @export
sb_get <- function(api_key, end_point, periodo_inicial, periodo_final = NULL,
entidad = NULL, tipo_entidad = NULL){
## Exit cuando entidad y tipo de entidad no sean nulas al mismo tiempo
if (!is.null(entidad) & !is.null(tipo_entidad)){
stop("Se introdujo entidad y tipo de entidad al mismo tiempo.")
}
## Define base_url
base_url <- "https://apis.sb.gob.do/estadisticas/"
## Get json
response_df <- httr::GET(paste0(base_url, end_point),
httr::add_headers("Ocp-Apim-Subscription-Key" = api_key),
query = list(
periodoInicial = periodo_inicial,
periodoFinal = periodo_final,
entidad = entidad,
tipoEntidad = tipo_entidad),
encode = "json")
print(response_df)
## Parse json to df
df <- httr::content(response_df, as = "text", encoding = "UTF-8")
df <- jsonlite::fromJSON(df)
## JSON to dataframe
df <- as.data.frame(df$data)
return(df)
}
sb_get("b0f966428bde45dc913ffd59d88b9dc0", "captaciones/localidad", "2020-01", entidad = "ACTIVO")
?as.Date()
sb_get("b0f966428bde45dc913ffd59d88b9dc0", "captaciones/localidad", periodo_inicial = "2020-01",periodo_final = "2019-01", entidad = "ACTIVO")
sb_get("b0f966428bde45dc913ffd59d88b9dc0", "captaciones/localidad", periodo_inicial = "2020-01",periodo_final = "2019-01", entidad = "ACTIVO")
print(as.Date("2020-01", "Y%-m%"))
as.Date("2020-01", "Y%-mm%")
as.Date("2020-01", "Y%-m%")
as.Date("2020-01")
as.Date("2020-01", "Y%-b%")
as.Date("2020-01", "%Y-%m")
as.Date("2020-01", "%Y-%m")
as.Date("2020-01", format = "%Y-%m")
as.Date("2020-01", format = "%Y-%m")
lct <- Sys.getlocale("LC_TIME")
Sys.setlocale("LC_TIME", "C")
as.Date("2020-01", format = "%Y-%m")
as.Date(as.POSIXct("2020-01"), format = "%Y-%m")
as.POSIXct.Date("2020-01")
as.Date("2020-01", format = "%Y-%m")
#' GET Endpoints SB
#'
#' Esta funcion carga los datos del endpoint solicitado en formato data frame
#' @param api_key Primary Key de la suscripcion.
#' @param end_point Endpoint a consultar. Usa 'end_points()' para ver
#' todas las opciones
#' @param periodo_inicial Fecha en donde incian las series solicitadas
#' @param periodo_final Fecha en donde terminan las series. No obligatoria.
#' @param entidad ID de la entidad a consultar. No se puede introducir al mismo
#' tiempo que 'tipo_entidad'. Usa 'entidades()' para ver todos los IDs.
#' @param tipo_entidad ID del tipo de entidad a consulta. No se puede introducir
#' al mimo tiempo que 'entidad'. Usa 'tipo_entidad()' para ver todas
#' las opciones
#' @return Dataframe con los datos del endpoint consultado
#' @export
sb_get <- function(api_key, end_point, periodo_inicial, periodo_final = NULL,
entidad = NULL, tipo_entidad = NULL){
## Exit cuando entidad y tipo de entidad no sean nulas al mismo tiempo
if (!is.null(entidad) & !is.null(tipo_entidad)){
stop("Se introdujo entidad y tipo de entidad al mismo tiempo.")
}
## Exit cuanto periodo inicial es posterior al final
inicial <- strptime(as.factor(periodo_inicial), format="%Y-%m")
final <- strptime(as.factor(periodo_final), format="%Y-%m")
if (as.Date(inicial, "Y%-m%") > as.Date(final, "Y%-m%")){
stop("Se introdujo un periodo inicial posterior al periodo final")
}
## Define base_url
base_url <- "https://apis.sb.gob.do/estadisticas/"
## Get json
response_df <- httr::GET(paste0(base_url, end_point),
httr::add_headers("Ocp-Apim-Subscription-Key" = api_key),
query = list(
periodoInicial = periodo_inicial,
periodoFinal = periodo_final,
entidad = entidad,
tipoEntidad = tipo_entidad),
encode = "json")
print(response_df)
## Parse json to df
df <- httr::content(response_df, as = "text", encoding = "UTF-8")
df <- jsonlite::fromJSON(df)
## JSON to dataframe
df <- as.data.frame(df$data)
return(df)
}
sb_get("b0f966428bde45dc913ffd59d88b9dc0", "captaciones/localidad", periodo_inicial = "2020-01",periodo_final = "2019-01", entidad = "ACTIVO")
inicial <- strptime(as.factor("2020-01"), format="%Y-%m")
inicial
library(lubridate)
#' GET Endpoints SB
#'
#' Esta funcion carga los datos del endpoint solicitado en formato data frame
#' @param api_key Primary Key de la suscripcion.
#' @param end_point Endpoint a consultar. Usa 'end_points()' para ver
#' todas las opciones
#' @param periodo_inicial Fecha en donde incian las series solicitadas
#' @param periodo_final Fecha en donde terminan las series. No obligatoria.
#' @param entidad ID de la entidad a consultar. No se puede introducir al mismo
#' tiempo que 'tipo_entidad'. Usa 'entidades()' para ver todos los IDs.
#' @param tipo_entidad ID del tipo de entidad a consulta. No se puede introducir
#' al mimo tiempo que 'entidad'. Usa 'tipo_entidad()' para ver todas
#' las opciones
#' @return Dataframe con los datos del endpoint consultado
#' @export
sb_get <- function(api_key, end_point, periodo_inicial, periodo_final = NULL,
entidad = NULL, tipo_entidad = NULL){
## Exit cuando entidad y tipo de entidad no sean nulas al mismo tiempo
if (!is.null(entidad) & !is.null(tipo_entidad)){
stop("Se introdujo entidad y tipo de entidad al mismo tiempo.")
}
## Exit cuanto periodo inicial es posterior al final
if (lubridate::ym(periodo_inicial) > lubridate::ym(periodo_final)){
stop("Se introdujo un periodo inicial posterior al periodo final")
}
## Define base_url
base_url <- "https://apis.sb.gob.do/estadisticas/"
## Get json
response_df <- httr::GET(paste0(base_url, end_point),
httr::add_headers("Ocp-Apim-Subscription-Key" = api_key),
query = list(
periodoInicial = periodo_inicial,
periodoFinal = periodo_final,
entidad = entidad,
tipoEntidad = tipo_entidad),
encode = "json")
print(response_df)
## Parse json to df
df <- httr::content(response_df, as = "text", encoding = "UTF-8")
df <- jsonlite::fromJSON(df)
## JSON to dataframe
df <- as.data.frame(df$data)
return(df)
}
sb_get("b0f966428bde45dc913ffd59d88b9dc0", "captaciones/localidad", periodo_inicial = "2020-01",periodo_final = "2019-01", entidad = "ACTIVO")
pacman::p_load(testthat)
pacman::p_load(Rtools)
install.packages('Rtools')
pacman::p_load(installr)
installr::updater()
pacman::p_load(Rtools)
install.packages("Rtools")
options(repos = getOption("repos")["CRAN"])
install.packages("Rtools")
library(supeRbancos)
install.packages("Rtools")
rm -Rf C:/Users/Trabajo/AppData/Local/Temp/RtmpYhalMt/Rd2pdf80c64fa69f2
install.packages("pdflatex")
library(devtools)
install.packages("devtools")
devtools::install_github("Lien3105/supeRbancos")
library(supeRbancos)
